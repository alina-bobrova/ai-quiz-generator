{% extends 'base.html' %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å - AI Quiz Generator{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Profile Header -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-8 mb-8 card-hover">
        <div class="flex items-center space-x-6">
            <div class="w-20 h-20 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center">
                <span class="text-white font-bold text-2xl">{{ user.username.0|upper }}</span>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ user.get_full_name|default:user.username }}</h1>
                <p class="text-gray-600 mb-4">@{{ user.username }}</p>
                <div class="flex space-x-6 text-sm">
                    <div class="flex items-center space-x-2">
                        <span class="text-primary">üìö</span>
                        <span class="text-gray-600">{{ user_quizzes_count }} —Ç–µ—Å—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–æ</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-accent">‚úÖ</span>
                        <span class="text-gray-600">{{ completed_quizzes }} –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Form -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-8 mb-8 card-hover">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
        
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        –õ–æ–≥–∏–Ω
                    </label>
                    {{ form.username }}
                    {% if form.username.errors %}
                        <div class="text-red-500 text-sm mt-1">{{ form.username.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <div>
                    <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        Email
                    </label>
                    {{ form.email }}
                    {% if form.email.errors %}
                        <div class="text-red-500 text-sm mt-1">{{ form.email.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        –ò–º—è
                    </label>
                    {{ form.first_name }}
                    {% if form.first_name.errors %}
                        <div class="text-red-500 text-sm mt-1">{{ form.first_name.errors.0 }}</div>
                    {% endif %}
                </div>
                
                <div>
                    <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        –§–∞–º–∏–ª–∏—è
                    </label>
                    {{ form.last_name }}
                    {% if form.last_name.errors %}
                        <div class="text-red-500 text-sm mt-1">{{ form.last_name.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="flex space-x-4">
                <button 
                    type="submit" 
                    class="bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1"
                >
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
                
                <a 
                    href="{% url 'change_password' %}" 
                    class="bg-gradient-to-r from-warning to-orange-500 hover:from-orange-500 hover:to-red-500 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1"
                >
                    üîí –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                </a>
            </div>
        </form>
    </div>

    <!-- Statistics -->
    <div class="grid md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 card-hover">
            <div class="text-center">
                <div class="text-4xl mb-4">üìä</div>
                <h3 class="text-xl font-semibold text-gray-900 mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">–°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤:</span>
                        <span class="font-semibold text-primary">{{ stats.total_quizzes_created }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">–ó–∞–≤–µ—Ä—à–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤:</span>
                        <span class="font-semibold text-accent">{{ stats.total_quizzes_completed }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">–û—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:</span>
                        <span class="font-semibold text-secondary">{{ stats.total_questions_answered }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</span>
                        <span class="font-semibold text-green-600">{{ stats.total_correct_answers }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">–¢–æ—á–Ω–æ—Å—Ç—å:</span>
                        <span class="font-semibold text-blue-600">{{ stats.get_accuracy_percentage|floatformat:1 }}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</span>
                        <span class="font-semibold text-purple-600">{{ stats.average_score|floatformat:1 }}%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">–ù–∞–∫–æ–ø–ª–µ–Ω–æ –æ—á–∫–æ–≤:</span>
                        <span class="font-semibold text-yellow-600">{{ stats.total_points }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 card-hover">
            <div class="text-center">
                <div class="text-4xl mb-4">üéØ</div>
                <h3 class="text-xl font-semibold text-gray-900 mb-4">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                <div class="space-y-3">
                    <div class="text-2xl font-bold text-accent mb-2">{{ user_achievements.count }}</div>
                    <p class="text-gray-600 text-sm mb-4">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</p>
                    {% if user_achievements %}
                        <div class="space-y-2 max-h-32 overflow-y-auto">
                            {% for achievement in user_achievements|slice:":3" %}
                            <div class="flex items-center justify-between text-sm p-2 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">{{ achievement.achievement.icon }}</span>
                                    <span class="text-gray-700">{{ achievement.achievement.name }}</span>
                                </div>
                                <span class="text-xs text-yellow-600 font-semibold">+{{ achievement.achievement.points }}</span>
                            </div>
                            {% endfor %}
                            {% if user_achievements.count > 3 %}
                            <div class="text-xs text-gray-500 text-center">+{{ user_achievements.count|add:"-3" }} –µ—â–µ</div>
                            {% endif %}
                        </div>
                    {% else %}
                        <p class="text-gray-500 text-sm">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</p>
                        <p class="text-xs text-gray-400 mt-1">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ –∏—Ö –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π!</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 card-hover">
            <div class="text-center">
                <div class="text-4xl mb-4">üèÜ</div>
                <h3 class="text-xl font-semibold text-gray-900 mb-4">–†–µ–π—Ç–∏–Ω–≥</h3>
                <div class="space-y-3">
                    <div class="text-2xl font-bold text-warning mb-2">#{{ user_rank }}</div>
                    <p class="text-gray-600 text-sm mb-4">–í–∞—à–µ –º–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ</p>
                    <div class="text-lg font-semibold text-primary">{{ stats.total_points }} –æ—á–∫–æ–≤</div>
                    <p class="text-gray-600 text-sm">–ù–∞–∫–æ–ø–ª–µ–Ω–æ –æ—á–∫–æ–≤</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Users -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 card-hover">
        <h3 class="text-xl font-semibold text-gray-900 mb-4 text-center">üèÜ –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
        <div class="space-y-3">
            {% for stat in top_users %}
            <div class="flex items-center justify-between p-3 rounded-lg {% if stat.user == user %}bg-primary/10 border border-primary/20{% else %}bg-gray-50{% endif %}">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-accent to-primary rounded-full flex items-center justify-center">
                        <span class="text-white font-semibold text-sm">{{ stat.user.username.0|upper }}</span>
                    </div>
                    <div>
                        <div class="font-semibold text-gray-900">{{ stat.user.get_full_name|default:stat.user.username }}</div>
                        <div class="text-sm text-gray-500">{{ stat.total_points }} –æ—á–∫–æ–≤</div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm font-semibold text-gray-600">#{{ forloop.counter }}</div>
                    <div class="text-xs text-gray-500">{{ stat.total_quizzes_completed }} —Ç–µ—Å—Ç–æ–≤</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
